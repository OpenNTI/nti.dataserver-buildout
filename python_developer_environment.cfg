# A build out useful for developers working
# on the backend code
[buildout]
extends =
		sphinxdoc.cfg
		phantomjs.cfg
		imagemagick.cfg
		developer_zeo_environment.cfg

parts +=
		omelette
		z3c_sphinxdoc
		phantomjs
		imagemagick
		libyaml
		pyyaml
		loginapp-file-links
		testrunner

[environment]
# Because of the order of inclusion, we need this here
webapp_path = ${buildout:sources-dir}/nti.web.app
loginapp_path = ${buildout:sources-dir}/NextThoughtLoginApp

[extra-sources]
z3c.recipe.sphinxdoc = git https://github.com/NextThought/z3c.recipe.sphinxdoc.git
nti.app.testing = svn https://repos.nextthought.com/svn/nti-svn/nti.app.testing/trunk
nti.integrationtests = svn https://repos.nextthought.com/svn/nti-svn/nti.integrationtests/trunk

[zope-app-ALL-eggs]
eggs=
	zope.app.apidoc
	zope.app.zcmlfiles
	zope.app.authentication
	zope.app.securitypolicy

[testing-ALL-eggs]
eggs=
	nose2
	nose2-cov
	zope.testrunner
	nti.app.testing
		
[eggs]
dataserver_egg = nti.dataserver[tools,test]
# If you want to test buildout recipes that use install_develop
# for themselves, they must be included in the eggs
eggs +=
		elpy
		linesman
		uncommitted
		nti.recipes.zcml
		${testing-ALL-eggs:eggs}
		${zope-app-ALL-eggs:eggs}

# These later give us a command that can be used to document code
# and, more importantly, registered utilities:
#   static-apidoc -v 1 -b -l -p /tmp/apidoc
# It takes some minor surgery to zope.app.apidoc.bookmodule (to remove
# things that aren't there anymore) and zape.app.apidoc.configure.zcml
# (to load nti.appserver and provide a feature so we don't conflict)

# We would like to be able to use zope.testrunner for its robust
# support of layers, auto-coverage, profiling, memory leak support,
# etc. But it's fatal flaw, compared to nose, is that it doesn't
# support test functions (or test generators); it only supports test
# methods inside test classes, and it doesn't support setUpClass
# fixtures (the preference is for layers). Until we eliminate those,
# we're stuck with nose or nose2.

# nose2 supports layers, but notice that layers require test classes
# (not test functions) so transitioning to layers is naturally
# a transition to zope.testrunner too...nose2 is transitional.
# Unfortunately, nose2 at 0.4.7 (release version as-of 2014-02-19)
# has a bad constraint on six, so we must check it out

[testrunner]
recipe = zc.recipe.testrunner
eggs =
		${eggs:dataserver_egg}
		nti.app.assessment
		nti.app.client_preferences
		nti.assessment
		nti.app.contenttypes.presentation
		nti.contenttypes.courses
		nti.app.testing
		nti.testing
		nti.plasTeX
		${site-ALL-eggs:eggs}
		${product-ALL-eggs:eggs}
		${rendering-ALL-eggs:eggs}

# Because 'test' is a reserved word in the shell,
# so you would have to give a full path
script = ztest
defaults = ['-p', '--auto-color', '-v']


#From external source
[pserve-conf]
dataserver_log_level = DEBUG

[extra-sources]
nti.hurry.workflow = svn https://repos.nextthought.com/svn/nti-svn/nti.hurry.workflow/trunk
nti.integrationtests = svn https://repos.nextthought.com/svn/nti-svn/nti.integrationtests/trunk
nti.learning_network = svn https://repos.nextthought.com/svn/nti-svn/nti.learning_network/trunk
nti.app.learning_network = svn https://repos.nextthought.com/svn/nti-svn/nti.app.learning_network/trunk

[zcml]
# All assignments
#package_features += assignments_for_everyone

[roles]
files += 667-alpha-rolemap.zcml

[site-sources]
<= site-ALL-sources

[eggs]
eggs +=
	 	nti.hurry.workflow
		nti.integrationtests
		nti.learning_network
		nti.app.learning_network
		zope.app.server
		nti.metadata

[server-versions]
sites = @HEAD

[webapp-versions]
NextThoughtWebApp = branch=master

[webapp-conf]
allow_mobile_safari = true
unauth_location = /landing/site.html
features =
        "notepad":true,
        "mutable-forums":true,
        "fancy-scroll":true,
        "v3matching":false,
        "threaded-forums": true,
        "transcript-follow-video":true,
        "bulk-resolve-users":true,
        "kaltura.progressive":true,
        "video-settings":true,
        "remove-history-tab":true,
        "notifications":true,
        "analytic-reports":true,
        "presence-menu": true,
        "custom-status": true,
        "state-transactions": true,
        "v2contacts" : true,
        "v2profiles": true,
        "save-progress": true,
        "request-alias-change": true,
        "course-gifts": true,
        "capture-analytics": true,
        "badges":true,
        "email-verify":true,
        "email-verification":true,
        "instructor-email":true,
        "section-switcher":true,
        "profile-activity-filters":true,
		"file-upload":true


