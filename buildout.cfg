[buildout]
extends =
		 versions.cfg
		 pyyaml.cfg
		 pillow.cfg
		 openldap.cfg
		 recipes.cfg
		 base_sources.cfg

update-versions-file = versions.cfg
show-picked-versions = true
# python_ldap and related can move.
parts =
		libyaml
		pyyaml
		cython
		lxml
		openssl
		openldap_client
		openldap_client-conf
		cyrus_sasl
		python_ldap
		pillow
		eggs
		checkversions

# Using 'true' causes issues with file templates and extra Z3C_RECIPE_FILETEMPLATE_BASE
# not being interpreted
relative-paths = false

# By default, buildout checks for
# updated eggs when the requirements
# specify no version or >=. This can
# be fairly slow if most requirements are
# unpinned. Setting newest to false
# makes this not happen. The command line
# arg -n can make it happen again
newest = false

# We manage our checkouts using mr.developer, which
# easily allows pinning versions (revision=XXX)
# and provides the 'develop' command with many
# useful actions (like 'rebuild)
# See https://pypi.python.org/pypi/mr.developer/
extensions = mr.developer

mr.developer-threads = 35
sources-dir = sources
auto-checkout = *
# always-checkout =
# This defaults to false. If it's true, then all packages specified by
# auto-checkout and currently in develop mode are updated during each
# buildout run. If set to force, then packages are updated even when
# they are dirty instead of asking interactively.

[server-versions]
# This section can be used to define version pins
# for mr.developer. Currently, we define one version
# pin for all components, as that's the safest way to be sure
# we have a matching set of components that work together.
# We also only define a version pin for the SVN repository,
# as the git components are non-critical (not used at runtime)
# or slow-changinge
# All = @33001
All =
sites =
plasTeX =
rendering =
dataserver =
geventwebsocket =
umysql = branch=full-buffer

[solr-sources]

[site-sources]

[extra-sources]

[forums-sources]

[webapp-sources]

[oubound-sources]

[product-sources]

[metadata-sources]

[recorder-sources]

[mobileapp-sources]

[completion-sources]

[dataserver-sources]

[publishing-sources]

[landingpage-sources]

[contentrendering-sources]

[analytics-sources]

[analytics-pandas-sources]

[learning-sources]

[spark-sources]

[orgsync-sources]

[ou-recommendations-sources]

[sources]
<= base-sources
   site-sources
   solr-sources
   extra-sources
   forums-sources
   webapp-sources
   spark-sources
   orgsync-sources
   oubound-sources
   product-sources
   recipes-sources
   learning-sources
   metadata-sources
   recorder-sources
   analytics-sources
   mobileapp-sources
   completion-sources
   dataserver-sources
   publishing-sources
   landingpage-sources
   contentrendering-sources
   analytics-pandas-sources
   ou-recommendations-sources

[cython]
recipe = zc.recipe.egg
# Need to include cython so it gets
# on the path and can be used by lxml
# and gevent. This needs to happen
# in a separate part so the scripts
# exist.
eggs =
	cython

[deployment]
root-directory = ${buildout:directory}

[lxml:macosx]
# we rely on the macports lxml
recipe = z3c.recipe.mkdir
paths = ${buildout:parts-directory}/lxml

[lxml:linux]
# A build of lxml that uses local libxml2 and libxslt
# for repeatability and to better work without
# having -dev packages installed.
recipe = z3c.recipe.staticlxml
# If this exact version was already present
# in buildout-eggs, it won't be rebuilt
egg = lxml==4.1.1
libxml2-url = http://xmlsoft.org/sources/libxml2-2.9.7.tar.gz
libxslt-url = http://xmlsoft.org/sources/libxslt-1.1.31.tar.gz

[eggs]
recipe = zc.recipe.egg
dataserver_egg = nti.dataserver[tools]
eggs =
	 cython
	 pillow
	 pip
	 ${:dataserver_egg}
interpreter = python
# Note that when scripts are installed,
# the order is not knowable. Thus it is not
# possible for one egg to reliable override
# a script from another egg, without
# explicitly listing exactly which scripts (from all
# eggs) to install. That is a large list, so
# we just need to make sure we don't have conflicts
# in names.
dependent-scripts = true
# Make sure all these scripts know where their
# home is, and that it is a buildout
initialization =
				import os
				os.environ['DATASERVER_DIR_IS_BUILDOUT'] = "1"
				os.environ['DATASERVER_DIR'] = "${deployment:root-directory}"
				os.environ['DATASERVER_ETC_DIR'] = "${deployment:etc-directory}"
				os.environ['DATASERVER_DATA_DIR'] = "${deployment:data-directory}"
				os.environ['CHAMELEON_CACHE'] = "${deployment:root-directory}/var/caches/chameleon_cache"

[translations]
# Update the message catalogs as appropriate
recipe = collective.recipe.cmd
on_install = true
on_update = true
cmds = for d in sources/*; do echo $d; test -f $d/babel.cfg && (cd $d && python ./setup.py extract_messages && python ./setup.py update_catalog && python ./setup.py compile_catalog); done

[ropeproject]
# Create a project file for rope containing all
# the eggs explicitly. This is not enabled by
# default because the .ropeprojects/config.py cannot
# be customized correctly. However, it is easy to get
# a decent path using omelette
recipe = collective.recipe.ropeproject
eggs = ${eggs:eggs}

[checkversions]
# Provides a 'checkversions' script
# that does the same thing as pip-review
# or pip list --outdated but for a buildout
recipe = zc.recipe.egg
eggs = z3c.checkversions [buildout]

[clean-pyc]
# Having .pyc or .pyo files around in develop eggs
# is dangerous if the source file was deleted. It
# can lead to things apparently working (e.g., imports,
# ZODB objects) that really won't on a fresh checkout.
recipe = collective.recipe.cmd
on_install = true
on_update = true
cmds = find ${buildout:sources-dir} -name "*.py[cod]" -delete

[omelette]
recipe = collective.recipe.omelette
eggs = ${eggs:eggs}
# By creating a flattened, non-namespaced directory of all installed
# packages, Omelette makes it easy to browse all code in one place. it
# also makes it easy to set a python path for PyDev and the like.
