[buildout]
extends =
		webapps.cfg
		haproxy_nginx_environment.cfg
		zeo_environment.cfg
		contentrendering.cfg
		hypatia.cfg

# NOTE: When extending multiple base configs,
# only the parts from the bottom config are
# installed by default (even if they all use 'parts +=').
# So if we want to install parts from both configs,
# we need to explicitly list them.
parts +=
	  openssl
	  haproxy
	  stunnel-cert
	  nginx
	  stunnel
	  nginx-conf
	  haproxy-conf
	  stunnel-conf
	  memcached
	  phantomjs
	  imagemagick
	  ext42
#	  tex-live-installer
#	  tex-live-profile
#	  tex-live

[site-sources]
<= site-ALL-sources

[product-sources]
<= product-ALL-sources

[site-zcml]
package_zcml =
			 ${site-ALL-eggs:eggs}

[product-zcml]
package_zcml =
			 ${product-ALL-eggs:eggs}
package_zcml -= nti.contenttypes.courses

[eggs]
eggs +=
	 tox
	 ${site-ALL-eggs:eggs}
	 ${product-ALL-eggs:eggs}

[nginx-conf]
nginx_daemon = off

[webapp-conf]
enable_logging = true
enable_global_onerror = false

[init_env]
# For development, install the initial test data and users
args = --with-example

[environment]
cache_servers = localhost:${memcached-conf:memcached-port}

[pserve-conf]
use_devmode = 1
secure_cookies = 0
debug_error_in_html = true
cookie_secret = devmode cookie secret
pyramid_includes = pyramid_debugtoolbar

[gunicorn-conf]
# Make it easy to debug by using one worker
# and not preloading
workers = 1
preload_app = False


[supervisor]
programs +=
		 1 stunnel ${deployment:bin-directory}/stunnel
		 1 nginx ${deployment:bin-directory}/nginx
		 1 haproxy ${deployment:bin-directory}/haproxy [-f ${deployment:etc-directory}/haproxy/haproxy.cfg -db]
		 ${memcached-conf:memcached-supervisor}

# Turn these off for developers since they don't do
# any good, and they probably don't work anyway
[crashmail_pserve]
supervisor =

[fatalmail]
supervisor =
